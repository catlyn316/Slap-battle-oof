-- Roblox å…¨èƒ½æ§åˆ¶å™¨ (å¢å¼·ç‰ˆ v2.6)
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")

if CoreGui:FindFirstChild("SpeedJumpController") then CoreGui.SpeedJumpController:Destroy() end
if playerGui:FindFirstChild("SpeedJumpController") then playerGui.SpeedJumpController:Destroy() end

local trueLightingBackup = {
    Ambient = Lighting.Ambient, OutdoorAmbient = Lighting.OutdoorAmbient,
    Brightness = Lighting.Brightness, ColorShift_Bottom = Lighting.ColorShift_Bottom,
    ColorShift_Top = Lighting.ColorShift_Top, FogEnd = Lighting.FogEnd
}
local postEffectBackups = {}
local atmosphereBackups = {}
local originalSpeed = 16
local originalJump = 50
local originalGravity = 196.2
local hasOriginalValues = false

local toggles = {
    speed=false, jump=false, gravity=false, fullbright=false,
    cameraDist=false, nofog=false, brightness=false, noclipWall=false,
    noclip=false, noFilter=false, slapAura=false
}
local values = {
    speed=25, jump=75, gravity=50, fullbright=0.8,
    cameraDist=125, brightness=2, wallTrans=0.8, floatSpeed=1, auraRange=17
}
local connections = {
    speed=nil, jump=nil, gravity=nil, fullbright=nil,
    nofog=nil, brightness=nil, noclipWall=nil, noclip=nil, noFilter=nil,
    fixCam=nil, camDistGuard=nil
}
local transparencyCache = {}
local noclipMode = "all"
local platform = nil
local isUpButtonPressed = false
local isDownButtonPressed = false

-- ä¿®å¾©é¡é ­ç‹€æ…‹
local fixCamEnabled = false
local fixCamZoom = 125  -- è¨˜ä½å•Ÿå‹•æ™‚çš„è·é›¢
local fixCamConn = nil

-- Slap Aura ç‹€æ…‹
local auraEnabled = false
local auraDetectedEvents = {}
local auraHookActive = false
local auraLastFire = 0

local function getOriginalValues()
    if toggles.speed or toggles.jump or toggles.gravity then return end
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            originalSpeed = humanoid.WalkSpeed
            originalJump = humanoid.UseJumpPower and humanoid.JumpPower or humanoid.JumpHeight
        end
    end
    originalGravity = Workspace.Gravity
    hasOriginalValues = true
end

local function backupPostEffects()
    for _, v in pairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") and not postEffectBackups[v] then
            postEffectBackups[v] = {Enabled=v.Enabled}
            if v:IsA("BloomEffect") then postEffectBackups[v].Intensity=v.Intensity; postEffectBackups[v].Size=v.Size; postEffectBackups[v].Threshold=v.Threshold
            elseif v:IsA("BlurEffect") then postEffectBackups[v].Size=v.Size
            elseif v:IsA("ColorCorrectionEffect") then postEffectBackups[v].Brightness=v.Brightness; postEffectBackups[v].Contrast=v.Contrast; postEffectBackups[v].Saturation=v.Saturation; postEffectBackups[v].TintColor=v.TintColor
            elseif v:IsA("SunRaysEffect") then postEffectBackups[v].Intensity=v.Intensity; postEffectBackups[v].Spread=v.Spread end
        end
    end
    if Workspace.CurrentCamera then
        for _, v in pairs(Workspace.CurrentCamera:GetChildren()) do
            if v:IsA("PostEffect") and not postEffectBackups[v] then
                postEffectBackups[v] = {Enabled=v.Enabled}
                if v:IsA("BloomEffect") then postEffectBackups[v].Intensity=v.Intensity; postEffectBackups[v].Size=v.Size; postEffectBackups[v].Threshold=v.Threshold
                elseif v:IsA("BlurEffect") then postEffectBackups[v].Size=v.Size
                elseif v:IsA("ColorCorrectionEffect") then postEffectBackups[v].Brightness=v.Brightness; postEffectBackups[v].Contrast=v.Contrast; postEffectBackups[v].Saturation=v.Saturation; postEffectBackups[v].TintColor=v.TintColor
                elseif v:IsA("SunRaysEffect") then postEffectBackups[v].Intensity=v.Intensity; postEffectBackups[v].Spread=v.Spread end
            end
        end
    end
end

local function backupAtmospheres()
    for _, v in pairs(Lighting:GetDescendants()) do
        if v:IsA("Atmosphere") and not atmosphereBackups[v] then
            atmosphereBackups[v] = {Density=v.Density,Offset=v.Offset,Color=v.Color,Decay=v.Decay,Glare=v.Glare,Haze=v.Haze}
        end
    end
end

local function updateLighting()
    if toggles.fullbright then
        if connections.brightness then connections.brightness:Disconnect() end
        if connections.fullbright then connections.fullbright:Disconnect() end
        connections.fullbright = RunService.RenderStepped:Connect(function()
            local a = math.min(values.fullbright, 1)
            Lighting.Ambient=Color3.new(a,a,a); Lighting.Brightness=values.fullbright
            Lighting.ColorShift_Bottom=Color3.new(a,a,a); Lighting.ColorShift_Top=Color3.new(a,a,a)
            Lighting.OutdoorAmbient=Color3.new(a,a,a)
        end)
    elseif toggles.brightness then
        if connections.fullbright then connections.fullbright:Disconnect() end
        if connections.brightness then connections.brightness:Disconnect() end
        Lighting.Ambient=trueLightingBackup.Ambient; Lighting.OutdoorAmbient=trueLightingBackup.OutdoorAmbient
        Lighting.ColorShift_Bottom=trueLightingBackup.ColorShift_Bottom; Lighting.ColorShift_Top=trueLightingBackup.ColorShift_Top
        connections.brightness = RunService.RenderStepped:Connect(function() Lighting.Brightness=values.brightness end)
    else
        if connections.fullbright then connections.fullbright:Disconnect() end
        if connections.brightness then connections.brightness:Disconnect() end
        Lighting.Ambient=trueLightingBackup.Ambient; Lighting.Brightness=trueLightingBackup.Brightness
        Lighting.OutdoorAmbient=trueLightingBackup.OutdoorAmbient
        Lighting.ColorShift_Bottom=trueLightingBackup.ColorShift_Bottom; Lighting.ColorShift_Top=trueLightingBackup.ColorShift_Top
    end
end

local function applySpeed(char)
    if not char then char=player.Character end; if not char then return end
    local hum=char:WaitForChild("Humanoid",10); if not hum then return end
    if connections.speed then connections.speed:Disconnect() end
    if toggles.speed then
        hum.WalkSpeed=values.speed
        connections.speed=hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function() if toggles.speed then hum.WalkSpeed=values.speed end end)
    else hum.WalkSpeed=20 end
end

local function applyJump(char)
    if not char then char=player.Character end; if not char then return end
    local hum=char:WaitForChild("Humanoid",10); if not hum then return end
    if connections.jump then connections.jump:Disconnect() end
    if toggles.jump then
        if hum.UseJumpPower then
            hum.JumpPower=values.jump
            connections.jump=hum:GetPropertyChangedSignal("JumpPower"):Connect(function() if toggles.jump then hum.JumpPower=values.jump end end)
        else
            hum.JumpHeight=values.jump
            connections.jump=hum:GetPropertyChangedSignal("JumpHeight"):Connect(function() if toggles.jump then hum.JumpHeight=values.jump end end)
        end
    else
        if hum.UseJumpPower then hum.JumpPower=originalJump else hum.JumpHeight=originalJump end
    end
end

local function applyNoclip(char)
    if connections.noclip then connections.noclip:Disconnect() end
    if toggles.noclip then
        connections.noclip=RunService.Stepped:Connect(function()
            local c=player.Character; if not c then return end
            for _, part in pairs(c:GetDescendants()) do if part:IsA("BasePart") then part.CanCollide=false end end
            if noclipMode=="players" then
                local hrp=c:FindFirstChild("HumanoidRootPart")
                if hrp then hrp.AssemblyLinearVelocity=Vector3.new(0,hrp.AssemblyLinearVelocity.Y,0) end
            end
        end)
    else
        local c=player.Character
        if c then for _, part in pairs(c:GetDescendants()) do if part:IsA("BasePart") then part.CanCollide=true end end end
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ä¿®å¾©é¡é ­åŠŸèƒ½
-- é‡å°æ‰‹æ©Ÿ/å¹³æ¿ä¸ŠéŠæˆ² bug å°è‡´è§¸æ§é¡é ­å¡ä½ç„¡æ³•ç§»å‹•
-- ä¿®å¾©æ–¹å¼ï¼šé‡ç½® CameraType + CameraModeï¼Œä¸¦é‡æ–°é€£æ¥ TouchEnabled é¡é ­
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function applyFixCamera()
    local cam = Workspace.CurrentCamera
    if not cam then return end

    -- å¼·åˆ¶é‡ç½®é¡é ­é¡å‹å’Œæ¨¡å¼
    cam.CameraType = Enum.CameraType.Custom
    player.CameraMode = Enum.CameraMode.Classic
    player.CameraMinZoomDistance = 0.5
    player.CameraMaxZoomDistance = 500

    -- æ¸…é™¤å¯èƒ½å°è‡´å¡ä½çš„ CameraOffset
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then hum.CameraOffset = Vector3.new(0,0,0) end
    end

    -- æ‰‹æ©Ÿ/å¹³æ¿è§¸æ§é¡é ­å¡ä½ä¿®å¾©ï¼š
    -- é€éçŸ­æš«åˆ‡æ› CameraType å†åˆ‡å›ä¾†ï¼Œå¼·åˆ¶ Roblox é‡æ–°åˆå§‹åŒ–è§¸æ§é¡é ­æ§åˆ¶å™¨
    task.delay(0.05, function()
        if Workspace.CurrentCamera then
            Workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
        end
        task.delay(0.08, function()
            if Workspace.CurrentCamera then
                Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
                player.CameraMode = Enum.CameraMode.Classic
                player.CameraMinZoomDistance = 0.5
                player.CameraMaxZoomDistance = 500
            end
        end)
    end)
end

local function startFixCamGuard()
    if fixCamConn then fixCamConn:Disconnect() end
    fixCamConn = RunService.Heartbeat:Connect(function()
        if not fixCamEnabled then return end
        local cam = Workspace.CurrentCamera
        if not cam then return end
        -- åµæ¸¬ CameraType è¢«éŠæˆ²æ”¹æ‰
        if cam.CameraType ~= Enum.CameraType.Custom then
            cam.CameraType = Enum.CameraType.Custom
        end
        -- åµæ¸¬ CameraMode è¢«éŠæˆ²å¼·åˆ¶ LockFirstPersonï¼ˆä¸æ˜¯ç©å®¶ç¸®å°ï¼‰
        if player.CameraMode == Enum.CameraMode.LockFirstPerson then
            player.CameraMode = Enum.CameraMode.Classic
            player.CameraMinZoomDistance = 0.5
            player.CameraMaxZoomDistance = 500
        end
        -- ç¢ºä¿ MaxZoom ä¸è¢«éŠæˆ²å£“ç¸®
        if player.CameraMaxZoomDistance < 10 then
            player.CameraMaxZoomDistance = 500
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Slap Aura Hook
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local auraPendingFire = false

local function startAuraHook()
    if auraHookActive then return end
    auraHookActive = true
    local origNamecall
    origNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local method = getnamecallmethod()
        local result = origNamecall(self, ...)
        if auraEnabled and method == "FireServer" and typeof(self) == "Instance" and self:IsA("RemoteEvent") then
            local args = {...}
            local found = false
            for _, v in ipairs(args) do
                if typeof(v) == "Instance" then
                    if v:IsA("Player") and v ~= player then found=true; break end
                    if v:IsA("Model") and v:FindFirstChildOfClass("Humanoid") and v ~= player.Character then found=true; break end
                    if v:IsA("BasePart") then
                        local p = v.Parent
                        if p and p:IsA("Model") and p:FindFirstChildOfClass("Humanoid") and p ~= player.Character then found=true; break end
                    end
                end
            end
            if found then
                local alreadyCaptured = false
                for _, entry in ipairs(auraDetectedEvents) do
                    if entry.event == self then alreadyCaptured=true; break end
                end
                if not alreadyCaptured then
                    table.insert(auraDetectedEvents, {event=self, args=args})
                    warn("[Slap Aura] æ–°å¢äº‹ä»¶: " .. self.Name .. " å…±" .. #auraDetectedEvents .. "å€‹")
                end
                local now = tick()
                if now - auraLastFire >= 1 then auraPendingFire = true end
            end
        end
        return result
    end)
end
pcall(startAuraHook)

local function fireAllAuraEvents(target)
    for _, entry in ipairs(auraDetectedEvents) do
        local newArgs = {}
        for _, v in ipairs(entry.args) do
            local replaced = false
            if typeof(v) == "Instance" then
                if v:IsA("Player") and v ~= player then
                    table.insert(newArgs, target); replaced=true
                elseif v:IsA("Model") and v:FindFirstChildOfClass("Humanoid") and v ~= player.Character then
                    table.insert(newArgs, target.Character or v); replaced=true
                elseif v:IsA("BasePart") then
                    local p = v.Parent
                    if p and p:IsA("Model") and p:FindFirstChildOfClass("Humanoid") and p ~= player.Character then
                        local tp = target.Character and target.Character:FindFirstChild(v.Name) or v
                        table.insert(newArgs, tp); replaced=true
                    end
                end
            end
            if not replaced then table.insert(newArgs, v) end
        end
        pcall(function() entry.event:FireServer(table.unpack(newArgs)) end)
    end
end

local function getNearestInRange(range)
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    local myPos = char.HumanoidRootPart.Position
    local nearest, nearestDist = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (p.Character.HumanoidRootPart.Position - myPos).Magnitude
            if dist <= range and dist < nearestDist then nearest=p; nearestDist=dist end
        end
    end
    return nearest
end

RunService.Heartbeat:Connect(function()
    if not auraEnabled then return end
    if not auraPendingFire then return end
    if #auraDetectedEvents == 0 then auraPendingFire=false; return end
    auraPendingFire = false
    auraLastFire = tick()
    local target = getNearestInRange(values.auraRange)
    if target then fireAllAuraEvents(target) end
end)

player.CharacterAdded:Connect(function(newChar)
    task.wait(0.5)
    if toggles.speed then applySpeed(newChar) end
    if toggles.jump then applyJump(newChar) end
    if toggles.noclip then applyNoclip(newChar) end
    if toggles.platform then if platform then platform:Destroy() end end
    if fixCamEnabled then task.wait(0.5); applyFixCamera() end
end)

-- ====================
-- UI å»ºæ§‹
-- ====================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SpeedJumpController"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 10001
local function parentUI(g)
    local ok = pcall(function()
        if gethui then g.Parent=gethui()
        elseif CoreGui then g.Parent=CoreGui
        else g.Parent=playerGui end
    end)
    if not ok then g.Parent=playerGui end
end
parentUI(screenGui)

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 262)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -131)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 32)
titleBar.BackgroundColor3 = Color3.fromRGB(102, 126, 234)
titleBar.Parent = mainFrame
Instance.new("UICorner", titleBar).CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -60, 1, 0)
title.BackgroundTransparency = 1
title.Text = "ğŸ® è²“ç²çš„å…¨èƒ½æ§åˆ¶å™¨ v2.6"
title.TextSize = 14
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = titleBar

local minimizeButton = Instance.new("TextButton")
minimizeButton.Size=UDim2.new(0,24,0,24); minimizeButton.Position=UDim2.new(1,-54,0,4)
minimizeButton.BackgroundColor3=Color3.fromRGB(158,158,158); minimizeButton.Text="â”€"
minimizeButton.TextColor3=Color3.fromRGB(255,255,255); minimizeButton.Parent=titleBar
Instance.new("UICorner", minimizeButton).CornerRadius=UDim.new(0,5)

local closeButton = Instance.new("TextButton")
closeButton.Size=UDim2.new(0,24,0,24); closeButton.Position=UDim2.new(1,-28,0,4)
closeButton.BackgroundColor3=Color3.fromRGB(244,67,54); closeButton.Text="X"
closeButton.TextColor3=Color3.fromRGB(255,255,255); closeButton.Parent=titleBar
Instance.new("UICorner", closeButton).CornerRadius=UDim.new(0,5)

-- åˆ†é åˆ—
local tabBar = Instance.new("Frame")
tabBar.Size=UDim2.new(0.9,0,0,28); tabBar.Position=UDim2.new(0.05,0,0,38)
tabBar.BackgroundColor3=Color3.fromRGB(240,240,240); tabBar.Parent=mainFrame
Instance.new("UICorner", tabBar).CornerRadius=UDim.new(0,6)

local function createTab(text, index)
    local tab = Instance.new("TextButton")
    tab.Size=UDim2.new(0.25,-4,1,-4); tab.Position=UDim2.new((index-1)*0.25,2,0,2)
    tab.BackgroundColor3=Color3.fromRGB(200,200,200); tab.Text=text; tab.TextSize=11
    tab.Font=Enum.Font.GothamBold; tab.TextColor3=Color3.fromRGB(100,100,100); tab.Parent=tabBar
    Instance.new("UICorner", tab).CornerRadius=UDim.new(0,4)
    return tab
end
local tab1=createTab("åŸºç¤ç§»å‹•",1)
local tab2=createTab("è¦–é‡ç‡ˆå…‰",2)
local tab3=createTab("ç©¿ç‰†é£„æµ®",3)
local tab4=createTab("Slap Aura",4)

local contentContainer = Instance.new("Frame")
contentContainer.Size=UDim2.new(0.9,0,0,150); contentContainer.Position=UDim2.new(0.05,0,0,72)
contentContainer.BackgroundTransparency=1; contentContainer.Parent=mainFrame; contentContainer.ClipsDescendants=true

local function createScrollingPage(parent)
    local page = Instance.new("ScrollingFrame")
    page.Size=UDim2.new(1,0,1,0); page.BackgroundTransparency=1; page.BorderSizePixel=0
    page.ScrollBarThickness=4; page.AutomaticCanvasSize=Enum.AutomaticSize.Y
    page.Visible=false; page.Parent=parent
    local layout = Instance.new("UIListLayout")
    layout.Padding=UDim.new(0,6); layout.SortOrder=Enum.SortOrder.LayoutOrder
    layout.HorizontalAlignment=Enum.HorizontalAlignment.Center; layout.Parent=page
    local padding = Instance.new("UIPadding")
    padding.PaddingRight=UDim.new(0,6); padding.Parent=page
    return page
end
local page1=createScrollingPage(contentContainer)
local page2=createScrollingPage(contentContainer)
local page3=createScrollingPage(contentContainer)
local page4=createScrollingPage(contentContainer)
page1.Visible=true

local function switchTab(n)
    page1.Visible=(n==1); page2.Visible=(n==2); page3.Visible=(n==3); page4.Visible=(n==4)
    local tabs={tab1,tab2,tab3,tab4}
    for i,t in ipairs(tabs) do
        t.BackgroundColor3=(i==n) and Color3.fromRGB(102,126,234) or Color3.fromRGB(200,200,200)
        t.TextColor3=(i==n) and Color3.new(1,1,1) or Color3.fromRGB(100,100,100)
    end
end
tab1.MouseButton1Click:Connect(function() switchTab(1) end)
tab2.MouseButton1Click:Connect(function() switchTab(2) end)
tab3.MouseButton1Click:Connect(function() switchTab(3) end)
tab4.MouseButton1Click:Connect(function() switchTab(4) end)
switchTab(1)

local function createControlRow(parent, labelText, placeholder, defaultVal, isInput, order)
    local frame=Instance.new("Frame"); frame.Size=UDim2.new(1,0,0,32); frame.BackgroundColor3=Color3.fromRGB(248,249,250); frame.LayoutOrder=order or 0; frame.Parent=parent; Instance.new("UICorner",frame).CornerRadius=UDim.new(0,6)
    local label=Instance.new("TextLabel"); label.Size=UDim2.new(0,75,1,0); label.Position=UDim2.new(0,6,0,0); label.BackgroundTransparency=1; label.Text=labelText; label.TextSize=12; label.Font=Enum.Font.GothamBold; label.TextColor3=Color3.fromRGB(85,85,85); label.TextXAlignment=Enum.TextXAlignment.Left; label.Parent=frame
    local input
    if isInput then
        input=Instance.new("TextBox"); input.Size=UDim2.new(0,65,0,22); input.Position=UDim2.new(0,80,0,5); input.BackgroundColor3=Color3.fromRGB(255,255,255); input.BorderSizePixel=1; input.BorderColor3=Color3.fromRGB(221,221,221); input.Text=defaultVal; input.PlaceholderText=placeholder; input.TextSize=13; input.Font=Enum.Font.Gotham; input.TextColor3=Color3.fromRGB(50,50,50); input.Parent=frame; Instance.new("UICorner",input).CornerRadius=UDim.new(0,5)
    else
        input=Instance.new("TextLabel"); input.Size=UDim2.new(0,65,0,22); input.Position=UDim2.new(0,80,0,5); input.BackgroundTransparency=1; input.Text="é—œé–‰"; input.TextSize=13; input.Font=Enum.Font.Gotham; input.TextColor3=Color3.fromRGB(150,150,150); input.Parent=frame
    end
    local btn=Instance.new("TextButton"); btn.Size=UDim2.new(0,50,0,22); btn.Position=UDim2.new(1,-55,0,5); btn.BackgroundColor3=Color3.fromRGB(76,175,80); btn.Text="å•Ÿå‹•"; btn.TextSize=12; btn.Font=Enum.Font.GothamBold; btn.TextColor3=Color3.fromRGB(255,255,255); btn.Parent=frame; Instance.new("UICorner",btn).CornerRadius=UDim.new(0,5)
    return frame, input, btn
end

-- é é¢1ï¼šåŸºç¤ç§»å‹•
local speedFrame,speedInput,speedButton=createControlRow(page1,"é€Ÿåº¦:","25","25",true,1)
local jumpFrame,jumpInput,jumpButton=createControlRow(page1,"è·³èº:","75","75",true,2)
local gravFrame,gravInput,gravButton=createControlRow(page1,"é‡åŠ›:","50","50",true,3)

-- é é¢2ï¼šè¦–é‡ç‡ˆå…‰ï¼ˆé¡é ­è·é›¢é è¨­125ï¼Œä¿®å¾©é¡é ­æ’åœ¨é¡é ­è·é›¢å¾Œé¢ order=3ï¼ŒåŸæœ¬çš„å¾€å¾Œæ¨ï¼‰
local fullbrightFrame,fullbrightInput,fullbrightButton=createControlRow(page2,"å…¨äº®:","0.8","0.8",true,1)
local cameraDistFrame,cameraDistInput,cameraDistButton=createControlRow(page2,"é¡é ­è·é›¢:","125","125",true,2)

-- ä¿®å¾©é¡é ­åˆ—ï¼ˆæŒ‰éˆ•æ–‡å­—å›ºå®šã€Œä¿®å¾©ã€ï¼ŒæŒ‰ä¸‹åŸ·è¡Œä¸€æ¬¡ï¼Œä¸åšé–‹é—œï¼‰
local fixCamFrame=Instance.new("Frame"); fixCamFrame.Size=UDim2.new(1,0,0,32); fixCamFrame.BackgroundColor3=Color3.fromRGB(248,249,250); fixCamFrame.LayoutOrder=3; fixCamFrame.Parent=page2; Instance.new("UICorner",fixCamFrame).CornerRadius=UDim.new(0,6)
local fixCamLabel=Instance.new("TextLabel"); fixCamLabel.Size=UDim2.new(0,95,1,0); fixCamLabel.Position=UDim2.new(0,6,0,0); fixCamLabel.BackgroundTransparency=1; fixCamLabel.Text="ä¿®å¾©é¡é ­:"; fixCamLabel.TextSize=12; fixCamLabel.Font=Enum.Font.GothamBold; fixCamLabel.TextColor3=Color3.fromRGB(85,85,85); fixCamLabel.TextXAlignment=Enum.TextXAlignment.Left; fixCamLabel.Parent=fixCamFrame
local fixCamStatusText=Instance.new("TextLabel"); fixCamStatusText.Size=UDim2.new(0,55,0,22); fixCamStatusText.Position=UDim2.new(0,100,0,5); fixCamStatusText.BackgroundTransparency=1; fixCamStatusText.Text="å¾…æ©Ÿ"; fixCamStatusText.TextSize=12; fixCamStatusText.Font=Enum.Font.Gotham; fixCamStatusText.TextColor3=Color3.fromRGB(150,150,150); fixCamStatusText.Parent=fixCamFrame
local fixCamButton=Instance.new("TextButton"); fixCamButton.Size=UDim2.new(0,50,0,22); fixCamButton.Position=UDim2.new(1,-55,0,5); fixCamButton.BackgroundColor3=Color3.fromRGB(33,150,243); fixCamButton.Text="ä¿®å¾©"; fixCamButton.TextSize=12; fixCamButton.Font=Enum.Font.GothamBold; fixCamButton.TextColor3=Color3.fromRGB(255,255,255); fixCamButton.Parent=fixCamFrame; Instance.new("UICorner",fixCamButton).CornerRadius=UDim.new(0,5)

local nofogFrame,nofogStatus,nofogButton=createControlRow(page2,"é™¤éœ§:","","",false,4)
local noFilterFrame,noFilterStatus,noFilterButton=createControlRow(page2,"ç„¡æ¿¾é¡:","","",false,5)
local noclipWallFrame,noclipWallInput,noclipWallButton=createControlRow(page2,"ç©¿ç‰†é¡é ­:","0.8","0.8",true,6)
local brightnessFrame,brightnessInput,brightnessButton=createControlRow(page2,"ç‡ˆå…‰:","2","2",true,7)

-- é é¢3ï¼šç©¿ç‰†é£„æµ®
local noclipMainFrame=Instance.new("Frame"); noclipMainFrame.Size=UDim2.new(1,0,0,32); noclipMainFrame.BackgroundColor3=Color3.fromRGB(248,249,250); noclipMainFrame.LayoutOrder=1; noclipMainFrame.Parent=page3; Instance.new("UICorner",noclipMainFrame).CornerRadius=UDim.new(0,6)
local noclipLabel=Instance.new("TextLabel"); noclipLabel.Text="Noclip:"; noclipLabel.Size=UDim2.new(0,55,1,0); noclipLabel.Position=UDim2.new(0,6,0,0); noclipLabel.BackgroundTransparency=1; noclipLabel.Font=Enum.Font.GothamBold; noclipLabel.TextSize=13; noclipLabel.TextColor3=Color3.fromRGB(85,85,85); noclipLabel.TextXAlignment=Enum.TextXAlignment.Left; noclipLabel.Parent=noclipMainFrame
local noclipModeButton=Instance.new("TextButton"); noclipModeButton.Text="å…¨éƒ¨"; noclipModeButton.Size=UDim2.new(0,65,0,22); noclipModeButton.Position=UDim2.new(0,60,0,5); noclipModeButton.BackgroundColor3=Color3.fromRGB(255,255,255); noclipModeButton.TextColor3=Color3.fromRGB(50,50,50); noclipModeButton.Font=Enum.Font.Gotham; noclipModeButton.TextSize=11; noclipModeButton.Parent=noclipMainFrame; Instance.new("UICorner",noclipModeButton).CornerRadius=UDim.new(0,5)
local noclipButton=Instance.new("TextButton"); noclipButton.Text="å•Ÿå‹•"; noclipButton.Size=UDim2.new(0,56,0,22); noclipButton.Position=UDim2.new(1,-60,0,5); noclipButton.BackgroundColor3=Color3.fromRGB(76,175,80); noclipButton.TextColor3=Color3.fromRGB(255,255,255); noclipButton.Font=Enum.Font.GothamBold; noclipButton.TextSize=13; noclipButton.Parent=noclipMainFrame; Instance.new("UICorner",noclipButton).CornerRadius=UDim.new(0,5)

local floatToggleFrame,floatStatus,floatButton=createControlRow(page3,"é£„æµ®:","","",false,2)
local floatControlFrame=Instance.new("Frame"); floatControlFrame.Size=UDim2.new(1,0,0,70); floatControlFrame.BackgroundColor3=Color3.fromRGB(248,249,250); floatControlFrame.Visible=false; floatControlFrame.LayoutOrder=3; floatControlFrame.Parent=page3; Instance.new("UICorner",floatControlFrame).CornerRadius=UDim.new(0,6)
local floatUpButton=Instance.new("TextButton"); floatUpButton.Text="â†‘ ä¸Šå‡"; floatUpButton.Size=UDim2.new(0.48,0,0,28); floatUpButton.Position=UDim2.new(0.02,0,0,4); floatUpButton.BackgroundColor3=Color3.fromRGB(70,130,200); floatUpButton.TextColor3=Color3.fromRGB(255,255,255); floatUpButton.Font=Enum.Font.GothamBold; floatUpButton.TextSize=13; floatUpButton.Parent=floatControlFrame; Instance.new("UICorner",floatUpButton).CornerRadius=UDim.new(0,5)
local floatDownButton=Instance.new("TextButton"); floatDownButton.Text="â†“ ä¸‹é™"; floatDownButton.Size=UDim2.new(0.48,0,0,28); floatDownButton.Position=UDim2.new(0.5,0,0,4); floatDownButton.BackgroundColor3=Color3.fromRGB(200,70,70); floatDownButton.TextColor3=Color3.fromRGB(255,255,255); floatDownButton.Font=Enum.Font.GothamBold; floatDownButton.TextSize=13; floatDownButton.Parent=floatControlFrame; Instance.new("UICorner",floatDownButton).CornerRadius=UDim.new(0,5)
local floatSpeedInput=Instance.new("TextBox"); floatSpeedInput.Text="1"; floatSpeedInput.Size=UDim2.new(0.6,0,0,28); floatSpeedInput.Position=UDim2.new(0.2,0,0,38); floatSpeedInput.BackgroundColor3=Color3.fromRGB(255,255,255); floatSpeedInput.TextColor3=Color3.fromRGB(50,50,50); floatSpeedInput.Font=Enum.Font.Gotham; floatSpeedInput.TextSize=13; floatSpeedInput.Parent=floatControlFrame; Instance.new("UICorner",floatSpeedInput).CornerRadius=UDim.new(0,5)

-- é é¢4ï¼šSlap Aura
local auraRangeFrame=Instance.new("Frame"); auraRangeFrame.Size=UDim2.new(1,0,0,32); auraRangeFrame.BackgroundColor3=Color3.fromRGB(248,249,250); auraRangeFrame.LayoutOrder=1; auraRangeFrame.Parent=page4; Instance.new("UICorner",auraRangeFrame).CornerRadius=UDim.new(0,6)
local auraRangeLabel=Instance.new("TextLabel"); auraRangeLabel.Text="ç¯„åœ:"; auraRangeLabel.Size=UDim2.new(0,55,1,0); auraRangeLabel.Position=UDim2.new(0,6,0,0); auraRangeLabel.BackgroundTransparency=1; auraRangeLabel.Font=Enum.Font.GothamBold; auraRangeLabel.TextSize=13; auraRangeLabel.TextColor3=Color3.fromRGB(85,85,85); auraRangeLabel.TextXAlignment=Enum.TextXAlignment.Left; auraRangeLabel.Parent=auraRangeFrame
local auraRangeInput=Instance.new("TextBox"); auraRangeInput.Text="17"; auraRangeInput.PlaceholderText="é è¨­17"; auraRangeInput.Size=UDim2.new(0,100,0,22); auraRangeInput.Position=UDim2.new(0,60,0,5); auraRangeInput.BackgroundColor3=Color3.fromRGB(255,255,255); auraRangeInput.TextColor3=Color3.fromRGB(50,50,50); auraRangeInput.Font=Enum.Font.Gotham; auraRangeInput.TextSize=13; auraRangeInput.BorderSizePixel=1; auraRangeInput.BorderColor3=Color3.fromRGB(221,221,221); auraRangeInput.Parent=auraRangeFrame; Instance.new("UICorner",auraRangeInput).CornerRadius=UDim.new(0,5)

local auraStatusFrame=Instance.new("Frame"); auraStatusFrame.Size=UDim2.new(1,0,0,32); auraStatusFrame.BackgroundColor3=Color3.fromRGB(248,249,250); auraStatusFrame.LayoutOrder=2; auraStatusFrame.Parent=page4; Instance.new("UICorner",auraStatusFrame).CornerRadius=UDim.new(0,6)
local auraStatusLabel=Instance.new("TextLabel"); auraStatusLabel.Text="Slap Aura:"; auraStatusLabel.Size=UDim2.new(0,85,1,0); auraStatusLabel.Position=UDim2.new(0,6,0,0); auraStatusLabel.BackgroundTransparency=1; auraStatusLabel.Font=Enum.Font.GothamBold; auraStatusLabel.TextSize=12; auraStatusLabel.TextColor3=Color3.fromRGB(85,85,85); auraStatusLabel.TextXAlignment=Enum.TextXAlignment.Left; auraStatusLabel.Parent=auraStatusFrame
local auraStateText=Instance.new("TextLabel"); auraStateText.Text="é—œé–‰"; auraStateText.Size=UDim2.new(0,55,0,22); auraStateText.Position=UDim2.new(0,90,0,5); auraStateText.BackgroundTransparency=1; auraStateText.Font=Enum.Font.Gotham; auraStateText.TextSize=13; auraStateText.TextColor3=Color3.fromRGB(150,150,150); auraStateText.Parent=auraStatusFrame
local auraToggleBtn=Instance.new("TextButton"); auraToggleBtn.Text="å•Ÿå‹•"; auraToggleBtn.Size=UDim2.new(0,50,0,22); auraToggleBtn.Position=UDim2.new(1,-55,0,5); auraToggleBtn.BackgroundColor3=Color3.fromRGB(76,175,80); auraToggleBtn.TextColor3=Color3.fromRGB(255,255,255); auraToggleBtn.Font=Enum.Font.GothamBold; auraToggleBtn.TextSize=12; auraToggleBtn.Parent=auraStatusFrame; Instance.new("UICorner",auraToggleBtn).CornerRadius=UDim.new(0,5)

local auraHintFrame=Instance.new("Frame"); auraHintFrame.Size=UDim2.new(1,0,0,44); auraHintFrame.BackgroundColor3=Color3.fromRGB(255,243,205); auraHintFrame.LayoutOrder=3; auraHintFrame.Parent=page4; Instance.new("UICorner",auraHintFrame).CornerRadius=UDim.new(0,6)
local auraHintLabel=Instance.new("TextLabel"); auraHintLabel.Size=UDim2.new(1,-12,1,0); auraHintLabel.Position=UDim2.new(0,6,0,0); auraHintLabel.BackgroundTransparency=1; auraHintLabel.Text="ğŸ’¡ é–‹å•Ÿå¾Œå…ˆæ‰‹å‹•æ‰“ä¸€å€‹äºº\nè®“ç³»çµ±åµæ¸¬åˆ°äº‹ä»¶å†è‡ªå‹•å¾ªç’°"; auraHintLabel.TextSize=11; auraHintLabel.Font=Enum.Font.Gotham; auraHintLabel.TextColor3=Color3.fromRGB(120,80,0); auraHintLabel.TextWrapped=true; auraHintLabel.TextXAlignment=Enum.TextXAlignment.Left; auraHintLabel.Parent=auraHintFrame

local statusLabel=Instance.new("TextLabel")
statusLabel.Size=UDim2.new(0.9,0,0,26); statusLabel.Position=UDim2.new(0.05,0,1,-32)
statusLabel.BackgroundColor3=Color3.fromRGB(255,235,238); statusLabel.Text="ç³»çµ±æœªå•Ÿå‹•"
statusLabel.TextSize=11; statusLabel.Font=Enum.Font.GothamBold
statusLabel.TextColor3=Color3.fromRGB(198,40,40); statusLabel.Parent=mainFrame
Instance.new("UICorner", statusLabel).CornerRadius=UDim.new(0,5)

-- ====================
-- åŠŸèƒ½å¯¦ä½œ
-- ====================
local function updateStatus()
    local active={}
    if toggles.speed then table.insert(active,"é€Ÿåº¦") end
    if toggles.fullbright then table.insert(active,"å…¨äº®") end
    if toggles.noclip then table.insert(active,"ç©¿ç‰†") end
    if toggles.noFilter then table.insert(active,"ç„¡æ¿¾é¡") end
    if auraEnabled then table.insert(active,"Aura") end
    if fixCamEnabled then table.insert(active,"ä¿®å¾©é¡é ­") end
    if #active > 0 then
        statusLabel.Text="âœ… "..table.concat(active," | ")
        statusLabel.BackgroundColor3=Color3.fromRGB(232,245,233); statusLabel.TextColor3=Color3.fromRGB(46,125,50)
    else
        statusLabel.Text="ç³»çµ±å°±ç·’"
        statusLabel.BackgroundColor3=Color3.fromRGB(255,235,238); statusLabel.TextColor3=Color3.fromRGB(198,40,40)
    end
end

local function toggleUIState(btn, frame, input, isActive)
    if isActive then
        btn.Text="è§£é™¤"; btn.BackgroundColor3=Color3.fromRGB(244,67,54)
        frame.BackgroundColor3=Color3.fromRGB(227,242,253)
        if input and input:IsA("TextBox") then input.TextEditable=false end
    else
        btn.Text="å•Ÿå‹•"; btn.BackgroundColor3=Color3.fromRGB(76,175,80)
        frame.BackgroundColor3=Color3.fromRGB(248,249,250)
        if input and input:IsA("TextBox") then input.TextEditable=true end
    end
    updateStatus()
end

speedButton.MouseButton1Click:Connect(function()
    toggles.speed=not toggles.speed
    if toggles.speed then if not hasOriginalValues then getOriginalValues() end; values.speed=tonumber(speedInput.Text) or 25; applySpeed()
    else applySpeed() end
    toggleUIState(speedButton,speedFrame,speedInput,toggles.speed)
end)

jumpButton.MouseButton1Click:Connect(function()
    toggles.jump=not toggles.jump
    if toggles.jump then if not hasOriginalValues then getOriginalValues() end; values.jump=tonumber(jumpInput.Text) or 75; applyJump()
    else applyJump() end
    toggleUIState(jumpButton,jumpFrame,jumpInput,toggles.jump)
end)

gravButton.MouseButton1Click:Connect(function()
    toggles.gravity=not toggles.gravity
    if toggles.gravity then
        if not hasOriginalValues then getOriginalValues() end
        values.gravity=tonumber(gravInput.Text) or 50; Workspace.Gravity=values.gravity
        if connections.gravity then connections.gravity:Disconnect() end
        connections.gravity=Workspace:GetPropertyChangedSignal("Gravity"):Connect(function() if toggles.gravity then Workspace.Gravity=values.gravity end end)
    else
        Workspace.Gravity=originalGravity
        if connections.gravity then connections.gravity:Disconnect() end
    end
    toggleUIState(gravButton,gravFrame,gravInput,toggles.gravity)
end)

fullbrightButton.MouseButton1Click:Connect(function()
    toggles.fullbright=not toggles.fullbright
    if toggles.fullbright then local v=tonumber(fullbrightInput.Text) or 0.8; values.fullbright=math.clamp(v,0,99); if v~=values.fullbright then fullbrightInput.Text=tostring(values.fullbright) end end
    updateLighting(); toggleUIState(fullbrightButton,fullbrightFrame,fullbrightInput,toggles.fullbright)
end)

brightnessButton.MouseButton1Click:Connect(function()
    toggles.brightness=not toggles.brightness
    if toggles.brightness then values.brightness=tonumber(brightnessInput.Text) or 2 end
    updateLighting(); toggleUIState(brightnessButton,brightnessFrame,brightnessInput,toggles.brightness)
end)

-- ä¿®å¾©é¡é ­æŒ‰éˆ•ï¼ˆæŒ‰ä¸€æ¬¡åŸ·è¡ŒåŠŸèƒ½ï¼ŒæŒ‰éˆ•æ–‡å­—æ°¸é ä¿æŒã€Œä¿®å¾©ã€ï¼‰
fixCamButton.MouseButton1Click:Connect(function()
    -- åŸ·è¡Œä¿®å¾©ï¼ˆä¸åšé–‹é—œï¼Œæ¯æ¬¡æŒ‰éƒ½é‡æ–°ä¿®å¾©ä¸€æ¬¡ï¼‰
    fixCamEnabled = true
    applyFixCamera()
    if not fixCamConn then startFixCamGuard() end
    -- çŸ­æš«é–ƒçˆå›é¥‹
    fixCamButton.BackgroundColor3 = Color3.fromRGB(46,125,50)
    fixCamStatusText.Text = "å·²ä¿®å¾©"
    fixCamStatusText.TextColor3 = Color3.fromRGB(46,125,50)
    fixCamFrame.BackgroundColor3 = Color3.fromRGB(232,245,233)
    task.delay(1.5, function()
        if fixCamButton and fixCamButton.Parent then
            fixCamButton.BackgroundColor3 = Color3.fromRGB(33,150,243)
            fixCamStatusText.Text = "å®ˆè­·ä¸­"
            fixCamStatusText.TextColor3 = Color3.fromRGB(33,150,243)
        end
    end)
    updateStatus()
end)

noFilterButton.MouseButton1Click:Connect(function()
    toggles.noFilter=not toggles.noFilter
    if toggles.noFilter then
        noFilterStatus.Text="é–‹å•Ÿ"; noFilterStatus.TextColor3=Color3.fromRGB(46,125,50)
        backupPostEffects()
        if connections.noFilter then connections.noFilter:Disconnect() end
        connections.noFilter=RunService.RenderStepped:Connect(function()
            for _,v in pairs(Lighting:GetChildren()) do
                if v:IsA("BloomEffect") then v.Intensity=0;v.Size=0;v.Threshold=2
                elseif v:IsA("BlurEffect") then v.Size=0
                elseif v:IsA("ColorCorrectionEffect") then v.Brightness=0;v.Contrast=0;v.Saturation=0;v.TintColor=Color3.fromRGB(255,255,255)
                elseif v:IsA("SunRaysEffect") then v.Intensity=0;v.Spread=0
                elseif v:IsA("DepthOfFieldEffect") then v.FarIntensity=0;v.NearIntensity=0 end
            end
            if Workspace.CurrentCamera then
                for _,v in pairs(Workspace.CurrentCamera:GetChildren()) do
                    if v:IsA("BloomEffect") then v.Intensity=0;v.Size=0;v.Threshold=2
                    elseif v:IsA("BlurEffect") then v.Size=0
                    elseif v:IsA("ColorCorrectionEffect") then v.Brightness=0;v.Contrast=0;v.Saturation=0;v.TintColor=Color3.fromRGB(255,255,255)
                    elseif v:IsA("SunRaysEffect") then v.Intensity=0;v.Spread=0
                    elseif v:IsA("DepthOfFieldEffect") then v.FarIntensity=0;v.NearIntensity=0 end
                end
            end
        end)
    else
        noFilterStatus.Text="é—œé–‰"; noFilterStatus.TextColor3=Color3.fromRGB(150,150,150)
        if connections.noFilter then connections.noFilter:Disconnect() end
        for effect,backup in pairs(postEffectBackups) do if effect and effect.Parent then for prop,value in pairs(backup) do pcall(function() effect[prop]=value end) end end end
        postEffectBackups={}
    end
    toggleUIState(noFilterButton,noFilterFrame,noFilterStatus,toggles.noFilter)
end)

nofogButton.MouseButton1Click:Connect(function()
    toggles.nofog=not toggles.nofog
    if toggles.nofog then
        nofogStatus.Text="é–‹å•Ÿ"; nofogStatus.TextColor3=Color3.fromRGB(46,125,50)
        backupAtmospheres()
        if connections.nofog then connections.nofog:Disconnect() end
        connections.nofog=RunService.RenderStepped:Connect(function()
            Lighting.FogEnd=100000
            for _,v in pairs(Lighting:GetDescendants()) do if v:IsA("Atmosphere") then v.Density=0;v.Offset=0;v.Glare=0;v.Haze=0 end end
        end)
    else
        nofogStatus.Text="é—œé–‰"; nofogStatus.TextColor3=Color3.fromRGB(150,150,150)
        if connections.nofog then connections.nofog:Disconnect() end
        Lighting.FogEnd=trueLightingBackup.FogEnd or 100000
        for atm,backup in pairs(atmosphereBackups) do if atm and atm.Parent then for prop,value in pairs(backup) do pcall(function() atm[prop]=value end) end end end
        atmosphereBackups={}
    end
    toggleUIState(nofogButton,nofogFrame,nofogStatus,toggles.nofog)
end)

cameraDistButton.MouseButton1Click:Connect(function()
    toggles.cameraDist=not toggles.cameraDist
    if toggles.cameraDist then
        values.cameraDist=tonumber(cameraDistInput.Text) or 125
        player.CameraMaxZoomDistance=values.cameraDist; player.CameraMinZoomDistance=values.cameraDist
        if player.Character then local hum=player.Character:FindFirstChildOfClass("Humanoid"); if hum then hum.CameraOffset=Vector3.new(0,0,0) end end
        task.delay(0.1,function() if toggles.cameraDist then player.CameraMinZoomDistance=0.5 end end)
        -- å•Ÿå‹•ç¬¬ä¸€äººç¨±å®ˆè­·ï¼ˆåªé˜²éŠæˆ²å¼·åˆ¶ï¼Œä¸é˜²ç©å®¶è‡ªå·±ç¸®å°ï¼‰
        if connections.camDistGuard then connections.camDistGuard:Disconnect() end
        local lastGameForcedCheck = tick()
        connections.camDistGuard = RunService.Heartbeat:Connect(function()
            if not toggles.cameraDist then
                if connections.camDistGuard then connections.camDistGuard:Disconnect(); connections.camDistGuard=nil end
                return
            end
            -- åªåœ¨ CameraMode è¢«éŠæˆ²å¼·åˆ¶è¨­æˆ LockFirstPerson æ™‚æ‰ä»‹å…¥
            -- ç©å®¶è‡ªå·±æŠŠé¡é ­æ»¾è¼ªç¸®åˆ° 0 ä¸æœƒè§¸ç™¼ LockFirstPersonï¼Œæ‰€ä»¥é€™è£¡æ˜¯å®‰å…¨çš„
            if player.CameraMode == Enum.CameraMode.LockFirstPerson then
                player.CameraMode = Enum.CameraMode.Classic
                player.CameraMinZoomDistance = 0.5
                player.CameraMaxZoomDistance = values.cameraDist
            end
        end)
    else
        player.CameraMaxZoomDistance=128; player.CameraMinZoomDistance=0.5
        if connections.camDistGuard then connections.camDistGuard:Disconnect(); connections.camDistGuard=nil end
    end
    toggleUIState(cameraDistButton,cameraDistFrame,cameraDistInput,toggles.cameraDist)
end)

noclipWallButton.MouseButton1Click:Connect(function()
    toggles.noclipWall=not toggles.noclipWall
    if toggles.noclipWall then
        values.wallTrans=tonumber(noclipWallInput.Text) or 0.8
        if connections.noclipWall then connections.noclipWall:Disconnect() end
        connections.noclipWall=RunService.RenderStepped:Connect(function()
            local cam=Workspace.CurrentCamera; local char=player.Character; if not char then return end
            local head=char:FindFirstChild("Head"); if not head then return end
            local camPos=cam.CFrame.Position; local headPos=head.Position
            for _,part in pairs(Workspace:GetDescendants()) do
                if part:IsA("BasePart") and not part:IsDescendantOf(char) then
                    local hit=Workspace:Raycast(headPos,(camPos-headPos),RaycastParams.new())
                    if hit and hit.Instance==part then
                        if not transparencyCache[part] then transparencyCache[part]=part.Transparency end
                        part.Transparency=values.wallTrans
                    elseif transparencyCache[part] then part.Transparency=transparencyCache[part]; transparencyCache[part]=nil end
                end
            end
        end)
        player.DevCameraOcclusionMode=Enum.DevCameraOcclusionMode.Invisicam
    else
        if connections.noclipWall then connections.noclipWall:Disconnect() end
        for part,t in pairs(transparencyCache) do part.Transparency=t end; transparencyCache={}
        player.DevCameraOcclusionMode=Enum.DevCameraOcclusionMode.Zoom
    end
    toggleUIState(noclipWallButton,noclipWallFrame,noclipWallInput,toggles.noclipWall)
end)

noclipModeButton.MouseButton1Click:Connect(function()
    if noclipMode=="all" then noclipMode="players"; noclipModeButton.Text="åƒ…ç©å®¶"
    else noclipMode="all"; noclipModeButton.Text="å…¨éƒ¨" end
end)

noclipButton.MouseButton1Click:Connect(function()
    toggles.noclip=not toggles.noclip; applyNoclip()
    if toggles.noclip then
        noclipButton.Text="è§£é™¤"; noclipButton.BackgroundColor3=Color3.fromRGB(244,67,54)
        noclipMainFrame.BackgroundColor3=Color3.fromRGB(227,242,253)
    else
        noclipButton.Text="å•Ÿå‹•"; noclipButton.BackgroundColor3=Color3.fromRGB(76,175,80)
        noclipMainFrame.BackgroundColor3=Color3.fromRGB(248,249,250)
    end
    updateStatus()
end)

local function createPlatform()
    if platform then platform:Destroy() end
    platform=Instance.new("Part"); platform.Name="FloatPlatform"
    platform.Size=Vector3.new(10,0.5,10); platform.Anchored=true
    platform.CanCollide=true; platform.Transparency=1
    local char=player.Character
    if char then local hrp=char:FindFirstChild("HumanoidRootPart"); if hrp then platform.Position=Vector3.new(hrp.Position.X,hrp.Position.Y-3.5,hrp.Position.Z) end end
    platform.Parent=Workspace
end

local function movePlatform(amount)
    if platform and toggles.platform then
        local char=player.Character
        if char then
            local hrp=char:FindFirstChild("HumanoidRootPart")
            if hrp then
                platform.Position=platform.Position+Vector3.new(0,amount,0)
                hrp.CFrame=CFrame.new(hrp.Position.X,platform.Position.Y+3.5,hrp.Position.Z)
            end
        end
    end
end

floatButton.MouseButton1Click:Connect(function()
    toggles.platform=not toggles.platform
    if toggles.platform then
        floatButton.Text="è§£é™¤"; floatButton.BackgroundColor3=Color3.fromRGB(244,67,54)
        floatStatus.Text="é–‹å•Ÿ"; floatStatus.TextColor3=Color3.fromRGB(46,125,50)
        floatToggleFrame.BackgroundColor3=Color3.fromRGB(227,242,253); floatControlFrame.Visible=true
        createPlatform()
    else
        floatButton.Text="å•Ÿå‹•"; floatButton.BackgroundColor3=Color3.fromRGB(76,175,80)
        floatStatus.Text="é—œé–‰"; floatStatus.TextColor3=Color3.fromRGB(150,150,150)
        floatToggleFrame.BackgroundColor3=Color3.fromRGB(248,249,250); floatControlFrame.Visible=false
        if platform then platform:Destroy() end
    end
    updateStatus()
end)

floatUpButton.MouseButton1Down:Connect(function() isUpButtonPressed=true end)
floatUpButton.MouseButton1Up:Connect(function() isUpButtonPressed=false end)
floatDownButton.MouseButton1Down:Connect(function() isDownButtonPressed=true end)
floatDownButton.MouseButton1Up:Connect(function() isDownButtonPressed=false end)
floatSpeedInput.FocusLost:Connect(function()
    values.floatSpeed=tonumber(floatSpeedInput.Text) or 1; floatSpeedInput.Text=tostring(values.floatSpeed)
end)

RunService.RenderStepped:Connect(function()
    if toggles.platform and platform then
        local char=player.Character
        if char then
            local hrp=char:FindFirstChild("HumanoidRootPart")
            if hrp then
                platform.Position=Vector3.new(hrp.Position.X,platform.Position.Y,hrp.Position.Z)
                if isUpButtonPressed then movePlatform(values.floatSpeed) end
                if isDownButtonPressed then movePlatform(-values.floatSpeed) end
            end
        end
    end
end)

-- Slap Aura é–‹é—œ
local auraActivatedConn = nil

local function setupAuraActivated()
    if auraActivatedConn then auraActivatedConn:Disconnect(); auraActivatedConn=nil end
    local char = player.Character
    if not char then return end
    local tool = char:FindFirstChildOfClass("Tool")
    if not tool then return end
    auraActivatedConn = tool.Activated:Connect(function()
        if not auraEnabled then return end
        local now = tick()
        if now - auraLastFire < 1 then return end
        auraPendingFire = true
    end)
end

player.CharacterAdded:Connect(function(newChar)
    task.wait(0.5)
    if auraEnabled then setupAuraActivated() end
    newChar.ChildAdded:Connect(function(child)
        if child:IsA("Tool") and auraEnabled then
            task.wait(0.1)
            setupAuraActivated()
        end
    end)
end)
if player.Character then
    player.Character.ChildAdded:Connect(function(child)
        if child:IsA("Tool") and auraEnabled then
            task.wait(0.1)
            setupAuraActivated()
        end
    end)
end

auraToggleBtn.MouseButton1Click:Connect(function()
    auraEnabled = not auraEnabled
    if auraEnabled then
        auraToggleBtn.Text="è§£é™¤"; auraToggleBtn.BackgroundColor3=Color3.fromRGB(244,67,54)
        auraStateText.Text="é–‹å•Ÿ"; auraStateText.TextColor3=Color3.fromRGB(46,125,50)
        auraStatusFrame.BackgroundColor3=Color3.fromRGB(227,242,253)
        values.auraRange = tonumber(auraRangeInput.Text) or 17
        auraDetectedEvents = {}
        auraLastFire = 0
        setupAuraActivated()
    else
        auraToggleBtn.Text="å•Ÿå‹•"; auraToggleBtn.BackgroundColor3=Color3.fromRGB(76,175,80)
        auraStateText.Text="é—œé–‰"; auraStateText.TextColor3=Color3.fromRGB(150,150,150)
        auraStatusFrame.BackgroundColor3=Color3.fromRGB(248,249,250)
        if auraActivatedConn then auraActivatedConn:Disconnect(); auraActivatedConn=nil end
    end
    updateStatus()
end)

-- æ‹–æ›³ï¼ˆåŠ å…¥ sinkInput é˜²æ­¢æ‹–æ›³æ™‚ç§»å‹•é¡é ­ï¼‰
local function enableDrag(frame, dragHandle)
    local dragging=false; local dragInput,dragStart,startPos
    local function update(input)
        local delta=input.Position-dragStart
        frame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
    end
    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
            dragging=true; dragStart=input.Position; startPos=frame.Position
            input.Changed:Connect(function() if input.UserInputState==Enum.UserInputState.End then dragging=false end end)
        end
    end)
    dragHandle.InputChanged:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch then dragInput=input end
    end)
    UserInputService.InputChanged:Connect(function(input) if input==dragInput and dragging then update(input) end end)
end
enableDrag(mainFrame, titleBar)

local miniFrame=Instance.new("Frame"); miniFrame.Size=UDim2.new(0,130,0,32); miniFrame.Position=UDim2.new(0.5,-65,0,30); miniFrame.BackgroundColor3=Color3.fromRGB(102,126,234); miniFrame.Visible=false; miniFrame.Parent=screenGui; Instance.new("UICorner",miniFrame).CornerRadius=UDim.new(0,6)
local miniTitle=Instance.new("TextLabel"); miniTitle.Text="ğŸ® æ§åˆ¶å™¨"; miniTitle.Size=UDim2.new(1,-36,1,0); miniTitle.BackgroundTransparency=1; miniTitle.Font=Enum.Font.GothamBold; miniTitle.TextSize=16; miniTitle.TextColor3=Color3.fromRGB(255,255,255); miniTitle.Parent=miniFrame
local expandButton=Instance.new("TextButton"); expandButton.Text="+"; expandButton.Size=UDim2.new(0,24,0,24); expandButton.Position=UDim2.new(1,-28,0,4); expandButton.BackgroundColor3=Color3.fromRGB(76,175,80); expandButton.TextColor3=Color3.fromRGB(255,255,255); expandButton.Parent=miniFrame; Instance.new("UICorner",expandButton).CornerRadius=UDim.new(0,5)
enableDrag(miniFrame, miniFrame)

minimizeButton.MouseButton1Click:Connect(function() mainFrame.Visible=false; miniFrame.Visible=true end)
expandButton.MouseButton1Click:Connect(function() miniFrame.Visible=false; mainFrame.Visible=true end)

closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
    for _, v in pairs(connections) do if v then v:Disconnect() end end
    if fixCamConn then fixCamConn:Disconnect() end
    Lighting.Ambient=trueLightingBackup.Ambient; Lighting.Brightness=trueLightingBackup.Brightness
    Lighting.OutdoorAmbient=trueLightingBackup.OutdoorAmbient
    Lighting.ColorShift_Top=trueLightingBackup.ColorShift_Top; Lighting.ColorShift_Bottom=trueLightingBackup.ColorShift_Bottom
    Lighting.FogEnd=trueLightingBackup.FogEnd
    for effect,backup in pairs(postEffectBackups) do if effect and effect.Parent then for prop,value in pairs(backup) do pcall(function() effect[prop]=value end) end end end
    for atm,backup in pairs(atmosphereBackups) do if atm and atm.Parent then for prop,value in pairs(backup) do pcall(function() atm[prop]=value end) end end end
    if platform then platform:Destroy() end
    player.CameraMinZoomDistance=0.5; player.CameraMaxZoomDistance=128
    player.CameraMode=Enum.CameraMode.Classic
    local char=player.Character
    if char then
        local hum=char:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed=originalSpeed; if hum.UseJumpPower then hum.JumpPower=originalJump else hum.JumpHeight=originalJump end end
        for _,part in pairs(char:GetDescendants()) do if part:IsA("BasePart") then part.CanCollide=true end end
    end
end)

task.spawn(function() if player.Character then task.wait(0.1); getOriginalValues() end end)


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ESP + é¢å‘ç©å®¶åŠŸèƒ½ï¼ˆShiftLock å·²ç§»é™¤ï¼‰
-- é¢å‘/ESP æµ®å‹•é¢æ¿æ”¯æ´æ‹–æ›³ï¼Œä¸”æ‹–æ›³æ™‚ä¸å½±éŸ¿é¡é ­
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
task.spawn(function() pcall(function()
    local ref = cloneref or function(x) return x end
    local S = function(n) return ref(game:GetService(n)) end
    local Plrs, Tw, UIS, RS, Wk, CG =
        S("Players"), S("TweenService"), S("UserInputService"), S("RunService"), S("Workspace"), S("CoreGui")
    local plr = Plrs.LocalPlayer

    if CG:FindFirstChild("ShiftLockUI") then CG.ShiftLockUI:Destroy() end
    local pg = plr:FindFirstChild("PlayerGui")
    if pg and pg:FindFirstChild("ShiftLockUI") then pg.ShiftLockUI:Destroy() end

    local function parentUI(g)
        if gethui then g.Name = "\0" .. g.Name; g.Parent = gethui()
        elseif CG then g.Parent = CG
        else g.Parent = plr:WaitForChild("PlayerGui") end
        return g
    end

    local function getParts()
        local c = plr.Character or plr.CharacterAdded:Wait()
        local hum = c:FindFirstChildOfClass("Humanoid") or c:WaitForChild("Humanoid")
        local hrp = c:FindFirstChild("HumanoidRootPart") or c:WaitForChild("HumanoidRootPart")
        return c, hum, hrp
    end

    local lockMode = "none"
    local rotCon = nil
    local targetPlayer = nil
    local mouseClickConn = nil
    local lastClickTime = 0
    local lastClickedPlayer = nil

    local gui = Instance.new("ScreenGui")
    gui.Name = "ShiftLockUI"; gui.ResetOnSpawn = false; gui.IgnoreGuiInset = true
    parentUI(gui)

    local nearBtn, clickBtn, espBtn, centerBtn

    local function updateButtonState(button, active)
        Tw:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = active and Color3.fromRGB(50,100,150) or Color3.fromRGB(40,40,45)
        }):Play()
        local stroke = button:FindFirstChild("BtnStroke")
        if stroke then
            Tw:Create(stroke, TweenInfo.new(0.2), {
                Color = active and Color3.fromRGB(0,200,255) or Color3.fromRGB(80,80,90),
                Thickness = active and 2 or 1
            }):Play()
        end
    end

    local function clearAllModes()
        if rotCon then rotCon:Disconnect(); rotCon = nil end
        if mouseClickConn then mouseClickConn:Disconnect(); mouseClickConn = nil end
        local _, h, _ = getParts()
        if h then h.AutoRotate = true end
        updateButtonState(nearBtn, false)
        updateButtonState(clickBtn, false)
        updateButtonState(centerBtn, false)
        lockMode = "none"
        targetPlayer = nil
        lastClickedPlayer = nil
    end

    local function setFaceRotation(type, target)
        if rotCon then rotCon:Disconnect() end
        local _, h, _ = getParts()
        h.AutoRotate = false
        rotCon = RS.RenderStepped:Connect(function()
            local _, _, myHRP = getParts()
            if not myHRP then return end
            local lookAtPos = nil
            if type == "nearest" then
                local nearest, minDist = nil, math.huge
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        local pRoot = p.Character.HumanoidRootPart
                        local d = (myHRP.Position - pRoot.Position).Magnitude
                        if d < minDist then minDist = d; nearest = pRoot end
                    end
                end
                if nearest then lookAtPos = nearest.Position end
            elseif type == "click" and target and target.Character then
                local pRoot = target.Character:FindFirstChild("HumanoidRootPart")
                if pRoot then lookAtPos = pRoot.Position end
            elseif type == "center" then
                lookAtPos = Vector3.new(0, myHRP.Position.Y, 0)
            end
            if lookAtPos then
                local flatDir = (lookAtPos - myHRP.Position) * Vector3.new(1, 0, 1)
                if flatDir.Magnitude > 0.001 then
                    myHRP.CFrame = CFrame.lookAt(myHRP.Position, myHRP.Position + flatDir.Unit, Vector3.yAxis)
                end
            end
        end)
    end

    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -- é¢å‘/ESP æµ®å‹•é¢æ¿ UI
    -- panel éŒ¨é»å³ä¸‹ï¼ŒtoggleBtn å›ºå®šåœ¨åº•ï¼ŒbtnContainer ç·Šè²¼ toggleBtn æ­£ä¸Šæ–¹å¾€ä¸Šå±•é–‹
    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    local panelWidth = 80
    local btnH = 30
    local btnGap = 3
    local numBtns = 4
    local expandedH = numBtns * btnH + (numBtns - 1) * btnGap
    local toggleBtnH = 28

    -- å¤–å±¤å®¹å™¨ï¼ŒAnchorPoint å³ä¸‹è§’ï¼Œpanel é«˜åº¦éš¨å±•é–‹è®ŠåŒ–
    local panel = Instance.new("Frame")
    panel.Name = "AnchorPanel"
    panel.AnchorPoint = Vector2.new(1, 1)
    panel.Size = UDim2.fromOffset(panelWidth, toggleBtnH)
    panel.Position = UDim2.new(1, -36, 1, -50)
    panel.BackgroundTransparency = 1
    panel.ClipsDescendants = false
    panel.Parent = gui

    -- ä¸»åˆ‡æ›æŒ‰éˆ•ï¼ˆå›ºå®šåœ¨ panel åº•éƒ¨ï¼ŒAnchorPoint å·¦ä¸‹ï¼‰
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.AnchorPoint = Vector2.new(0, 1)
    toggleBtn.Size = UDim2.fromOffset(panelWidth, toggleBtnH)
    toggleBtn.Position = UDim2.new(0, 0, 1, 0)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(45,45,55)
    toggleBtn.Text = "é¢å‘/ESP â–²"
    toggleBtn.TextSize = 11
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextColor3 = Color3.fromRGB(200,200,220)
    toggleBtn.AutoButtonColor = false
    toggleBtn.Parent = panel
    Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0,6)

    -- é—œé–‰æŒ‰éˆ•ï¼ˆxï¼Œåœ“è§’æ­£æ–¹å½¢ï¼Œè²¼åœ¨ä¸»æŒ‰éˆ•å³å´åŒé«˜ï¼‰
    local xBtn = Instance.new("TextButton")
    xBtn.Size = UDim2.fromOffset(22, 22)
    xBtn.AnchorPoint = Vector2.new(0, 1)
    xBtn.Position = UDim2.new(1, 4, 1, -3)
    xBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
    xBtn.Text = "x"
    xBtn.TextSize = 13
    xBtn.Font = Enum.Font.GothamBold
    xBtn.TextColor3 = Color3.new(1,1,1)
    xBtn.AutoButtonColor = false
    xBtn.Parent = panel
    Instance.new("UICorner", xBtn).CornerRadius = UDim.new(0,5)

    -- åŠŸèƒ½æŒ‰éˆ•å®¹å™¨ï¼ˆç·Šè²¼ toggleBtn æ­£ä¸Šæ–¹ï¼ŒClipsDescendants åšå±•é–‹å‹•ç•«ï¼‰
    local btnContainer = Instance.new("Frame")
    btnContainer.AnchorPoint = Vector2.new(0, 1)
    btnContainer.Size = UDim2.fromOffset(panelWidth, 0)
    btnContainer.Position = UDim2.new(0, 0, 1, -toggleBtnH)
    btnContainer.BackgroundTransparency = 1
    btnContainer.ClipsDescendants = true
    btnContainer.Parent = panel

    local function createExtraBtn(name, idx)
        local b = Instance.new("TextButton")
        b.Name = name
        b.Size = UDim2.fromOffset(panelWidth, btnH)
        b.Position = UDim2.fromOffset(0, (idx-1)*(btnH+btnGap))
        b.BackgroundColor3 = Color3.fromRGB(38,38,48)
        b.Text = name
        b.TextSize = 11
        b.TextColor3 = Color3.new(1,1,1)
        b.AutoButtonColor = false
        b.Parent = btnContainer
        Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
        local s = Instance.new("UIStroke"); s.Thickness=1; s.Color=Color3.fromRGB(70,70,85); s.Name="BtnStroke"; s.Parent=b
        return b
    end

    espBtn    = createExtraBtn("ESP",     1)
    nearBtn   = createExtraBtn("é¢å‘æœ€è¿‘", 2)
    clickBtn  = createExtraBtn("é¢å‘é›™æ“Š", 3)
    centerBtn = createExtraBtn("æœå‘ä¸­å¤®", 4)

    local isExpanded = false

    local function setExpanded(expand)
        isExpanded = expand
        local targetH = expand and expandedH or 0
        Tw:Create(btnContainer, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(panelWidth, targetH)
        }):Play()
        Tw:Create(panel, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.fromOffset(panelWidth, toggleBtnH + targetH)
        }):Play()
        toggleBtn.Text = expand and "é¢å‘/ESP â–¼" or "é¢å‘/ESP â–²"
    end

    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -- æ‹–æ›³ï¼ˆç§»å‹•è¶…é 5px æ‰ç®—æ‹–ï¼Œé˜²æ­¢èª¤è§¸ï¼‰
    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    local isDragging = false
    local dragMoved = false
    local dragStartPos = nil
    local panelStartPos = nil

    toggleBtn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
           or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            dragMoved = false
            dragStartPos = input.Position
            panelStartPos = panel.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    isDragging = false
                end
            end)
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStartPos
            if delta.Magnitude > 5 then
                dragMoved = true
                panel.Position = UDim2.new(
                    panelStartPos.X.Scale, panelStartPos.X.Offset + delta.X,
                    panelStartPos.Y.Scale, panelStartPos.Y.Offset + delta.Y
                )
            end
        end
    end)

    toggleBtn.MouseButton1Click:Connect(function()
        if not dragMoved then
            setExpanded(not isExpanded)
        end
        dragMoved = false
    end)

    UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
           or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)


    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -- æŒ‰éˆ•é‚è¼¯
    -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    nearBtn.MouseButton1Click:Connect(function()
        if lockMode == "nearest" then clearAllModes()
        else clearAllModes(); lockMode="nearest"; updateButtonState(nearBtn,true); setFaceRotation("nearest") end
    end)

    clickBtn.MouseButton1Click:Connect(function()
        if lockMode == "click" then clearAllModes()
        else
            clearAllModes(); lockMode="click"; updateButtonState(clickBtn,true)
            mouseClickConn = plr:GetMouse().Button1Down:Connect(function()
                local mouse=plr:GetMouse(); local cam=Wk.CurrentCamera
                local ray=cam:ScreenPointToRay(mouse.X,mouse.Y)
                local foundPlayer=nil; local minDistance=math.huge
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp=p.Character.HumanoidRootPart
                        local rayToPlayer=hrp.Position-ray.Origin
                        local projection=rayToPlayer:Dot(ray.Direction.Unit)
                        if projection > 0 then
                            local closestPoint=ray.Origin+ray.Direction.Unit*projection
                            local distance=(hrp.Position-closestPoint).Magnitude
                            if distance < 8 and projection < minDistance then minDistance=projection; foundPlayer=p end
                        end
                    end
                end
                if foundPlayer and foundPlayer ~= plr then
                    local now=tick()
                    if lastClickedPlayer==foundPlayer and (now-lastClickTime) < 0.5 then
                        targetPlayer=foundPlayer; setFaceRotation("click",foundPlayer)
                    end
                    lastClickedPlayer=foundPlayer; lastClickTime=now
                end
            end)
        end
    end)

    centerBtn.MouseButton1Click:Connect(function()
        if lockMode == "center" then clearAllModes()
        else clearAllModes(); lockMode="center"; updateButtonState(centerBtn,true); setFaceRotation("center") end
    end)

    -- ESP
    local espEnabled = false
    local espLabels = {}
    local espBoxes = {}
    local espConn = nil

    local function cleanupESP(p)
        if espLabels[p] then if espLabels[p].billboard then espLabels[p].billboard:Destroy() end; espLabels[p]=nil end
        if espBoxes[p] then espBoxes[p]:Destroy(); espBoxes[p]=nil end
    end

    espBtn.MouseButton1Click:Connect(function()
        espEnabled = not espEnabled
        updateButtonState(espBtn, espEnabled)
        if not espEnabled then
            if espConn then espConn:Disconnect(); espConn=nil end
            for p in pairs(espLabels) do cleanupESP(p) end
        else
            espConn = RS.RenderStepped:Connect(function()
                local _, _, myHRP = getParts()
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr then
                        local char=p.Character
                        local hrp=char and char:FindFirstChild("HumanoidRootPart")
                        local hum=char and char:FindFirstChildOfClass("Humanoid")
                        if char and hrp and hum and hum.Health > 0 then
                            if not espLabels[p] then
                                local bg=Instance.new("BillboardGui")
                                bg.Size=UDim2.fromOffset(200,50); bg.AlwaysOnTop=true
                                bg.StudsOffset=Vector3.new(0,3,0); bg.Parent=gui
                                local tl=Instance.new("TextLabel")
                                tl.Size=UDim2.fromScale(1,1); tl.BackgroundTransparency=1
                                tl.TextColor3=Color3.new(1,1,1); tl.TextStrokeTransparency=0.5
                                tl.TextSize=14; tl.Font=Enum.Font.SourceSansBold; tl.Parent=bg
                                espLabels[p]={billboard=bg,label=tl}
                            end
                            if not espBoxes[p] then
                                local box=Instance.new("BoxHandleAdornment")
                                box.Name="ESPBox"; box.AlwaysOnTop=true; box.ZIndex=1
                                box.Transparency=0.7; box.Color3=Color3.new(1,1,1); box.Parent=gui
                                espBoxes[p]=box
                            end
                            local dist=myHRP and (myHRP.Position-hrp.Position).Magnitude or 0
                            local lab=espLabels[p]
                            lab.billboard.Adornee=hrp
                            lab.label.Text=string.format("å: %s\nè¡€é‡: %.0f\nè·é›¢: %.1f",p.Name,hum.Health,dist)
                            espBoxes[p].Adornee=char; espBoxes[p].Size=char:GetExtentsSize()
                        else cleanupESP(p) end
                    end
                end
                for p in pairs(espLabels) do if not Plrs:FindFirstChild(p.Name) then cleanupESP(p) end end
            end)
        end
    end)

    xBtn.MouseButton1Click:Connect(function()
        clearAllModes()
        if espConn then espConn:Disconnect() end
        for p in pairs(espLabels) do cleanupESP(p) end
        gui:Destroy()
    end)

    plr.CharacterAdded:Connect(function()
        task.wait(0.5)
        if lockMode ~= "none" then setFaceRotation(lockMode, targetPlayer) end
    end)

end) end)
